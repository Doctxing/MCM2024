# Coded by iXterior

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from datetime import datetime
import numpy as np
import math

def my(address:str):
    df = pd.read_csv(address+'.csv')

    df['G'] = 0.
    for i in range(1,df.shape[0]):
        df.loc[i,'G'] = df.loc[i,'DELM'] - df.loc[i-1,'DELM']
    df.dropna().reset_index(drop=True)
    print(df.loc[:,'G'].values)

    # P(模拟概率值的建模，P越靠近0.5说明预测为逆风局边缘，双方差距不大，靠近0——1优势，靠近1——2优势)
    P = np.zeros(df.shape[0]) 
    for i in range(0,df.shape[0]):
        n = 0
        if i==0:
            P[i] = 0.01
            continue
        for j in range(0,df.shape[0]):
            if df.loc[i,'G'] > df.loc[j,'G']:
                n+=1
            else:
                pass
        P[i] = (n/df.shape[0])
    print(P)

    def dimensionlessProcessing(nparr:np.array):
        MAX  = np.max(nparr)
        MIN  = np.min(nparr)
        MEAN = np.mean(nparr)
        return ((nparr - MEAN) / (MAX - MIN))

    # Score 上一轮的两者单game的分数差
    Score = np.array([df.loc[i,'p1_score'] - df.loc[i,'p2_score'] for i in range(0,df.shape[0])])
    #Score = dimensionlessProcessing(Score)
    print(Score)

    # Server
    Server = -(df.loc[:,'server'].values * 2 - 3)
    #Server = dimensionlessProcessing(Server)
    print(Server)

    # G 上一轮的 G 值 对 这一轮的概率有何影响
    G = np.zeros(df.shape[0])
    for i in range(1,df.shape[0]):
        G[i] = df.loc[i-1,'G']
    #G = dimensionlessProcessing(G)
    print(G)

    # Bp 赛点
    Bp = df.loc[:,'p1_break_pt'].values - df.loc[:,'p2_break_pt'].values
    #Bp = dimensionlessProcessing(Bp)
    print(Bp)

    # R 两者跑动距离之差
    R = df.loc[:,'1runsum'].values - df.loc[:,'2runsum'].values
    #R = dimensionlessProcessing(R)
    print(R)

    # V 球速
    V = df.loc[:,'speed_mph'].values
    V = dimensionlessProcessing(V)
    print(V)

    # S_wdh 发球者
    S_wdh = df.loc[:,'serve_width'].values
    s0 = np.zeros(df.shape[0])
    s1 = np.zeros(df.shape[0])
    s2 = np.zeros(df.shape[0])
    s3 = np.zeros(df.shape[0])
    s4 = np.zeros(df.shape[0])

    for i in range(df.shape[0]):
        if S_wdh[i] == 0:
            s0[i] = 1
        elif S_wdh[i] == 1:
            s1[i] = 1
        elif S_wdh[i] == 2:
            s2[i] = 1
        elif S_wdh[i] == 3:
            s3[i] = 1
        else:
            s4[i] = 1

    #S_wdh = dimensionlessProcessing(S_wdh)
    print(S_wdh)
    print('you')

    # S_dph 发球者
    S_dph = df.loc[:,'serve_depth'].values
    #S_dph = dimensionlessProcessing(S_dph)
    print(S_dph)

    # R_dph 接求者
    R_dph = df.loc[:,'serve_depth'].values
    #R_dph = dimensionlessProcessing(R_dph)
    print(R_dph)

    # Net 
    Net = df.loc[:,'p1_net_pt'].values - df.loc[:,'p2_net_pt'].values
    #Net = dimensionlessProcessing(Net)
    print(Net)

    def writer(fl,arr,arg,end= True):
        fl.write(arg+'=c(')
        for i in range(len(arr)):
            fl.write(str(round(arr[i],4)))
            if i!= len(arr)-1:
                fl.write(', ')
            else:
                pass
        if end == True:
            fl.write('),\n')

    '''
    with open('data.txt',"w") as fl:
        fl.write('list( N='+str(df.shape[0])+',')
        writer(fl,P,'P')
        writer(fl,Score,'Score')
        writer(fl,Server,'Server')
        writer(fl,Bp,'Bp')
        writer(fl,R,'R')
        writer(fl,V,'V')
        writer(fl,s0,'s0')
        writer(fl,s1,'s1')
        writer(fl,s2,'s2')
        writer(fl,s3,'s3')
        writer(fl,s4,'s4')
        writer(fl,S_dph,'S_dph')
        writer(fl,R_dph,'R_dph')
        writer(fl,Net,'Net')
        writer(fl,G,'G',end=False)
        fl.write('))')'''




    '''
    
    a0 = -0.8602022807465414
    delta = [
    -0.01434298322232666,-0.05049199808874198,-0.005155093690557794,0.02387791274597048,0.03815211982988329,
    -0.02618646115744342,0.01464412499887603,0.01527164787852423,7.615968371043563E-4,-0.001483665632304256,
    0.05156011081635451,-0.003811356784449163,-0.02009427625291285,-0.05587697298704648,0.04697643490048246,
    0.0242433656614209,0.0556366081596904,0.01695772964535665,0.009672299684254143,0.001165308858866957,
    -0.007449987517052496,-0.03000473123153157,-0.06210877959324362,-0.06131297418094608,-0.01304681149565024,
    -0.001026677753614943,0.04752210417475568,-0.01689631684474287,0.03755281567090923,0.02059193948594701,
    0.02624552525934024,0.0157392353169595,-0.04401381641023764,-0.006544491133841341,0.05912049149373132,
    0.009361684818893131,-0.07966427155665813,0.01361671697986122,0.01604943558737358,-0.0236981704912175,
    -0.01453855193392986,0.03207179407520849,0.05093608165555853,0.05090371764906798,0.006964277519294099,
    -0.0096123512951489,-0.002133577737996278,0.01439116295159832,0.01218407985298863,0.009586271736652231,
    2.467890736518766E-4,0.02604342026990285,-0.009217521624882518,-0.01262102236435896,-0.02618891015278527,
    -0.02789544643681335,-0.009999026347643814,0.03987190432382903,0.01269984752428776,0.01381783558398399,
    0.007032746044122447,0.02357751479672828,-0.004764418637220973,-0.0370277242191448,0.02491175758553084,
    0.03081431664368856,-0.01982537464382607,0.007129542660068256,-0.001327055925075565,-0.02858397248201733,
    0.03766350339152515,0.03789936197317479,-0.006109815600857098,0.001996175547877088,-0.01144234215670463,
    -0.01161518003703417,-0.04005996880656083,0.02721291753607871,-0.01042991228873017,0.055753539915999,
    0.009117018090720727,-0.04423299852180892,-0.06660864001614221,-0.001122749938117591,-0.008231649115012857,
    -0.05305875895135944,0.0251393548621112,-0.01613067960500555,-0.005175302189804219,-0.002704500023176169,
    -0.0134963065884116,0.01626659988537888,0.01066231461723771,-0.01134333771100327,0.01415177391452599,
    0.05273661389845648,-0.01170891852067173,0.00866728714095007,-0.07618743810354697,0.02857765459015821,
    -0.0258903141063883,-0.02691909106503558,-0.02182306995085216,-0.02256168664023891,-0.01428254437083429,
    -0.03985732006745524,-0.002607259231169579,-0.02186728975970238,-0.02394419857811795,0.004278474751970474,
    0.01051598319683182,0.01612789020621928,-0.01419992715495801,-0.01867152687375279,0.01236011141764796,
    -0.00379500158065642,-0.03538555932607532,-0.04156824593383723,0.007413217473932147,0.04436735883836328,
    0.001185157828912634,-0.006289424647056189,-0.009455742652496527,0.06105642447701094,0.03911695777029437,
    0.04146404542908758,0.02225967678044149,0.01440877249260689,0.02427612232947072,-0.03384795285695332,
    0.03347131248772648,-0.01253056149221984,-0.04294341980276417,0.006985230986507077,0.04081854223733477,
    0.001277328799192982,0.02232920222230472,0.02637469926947527,-0.01295296976200728,0.009155429951265979,
    -9.132934794837539E-4,0.02081617086536358,0.03702714769461971,0.01228368269966283,-0.007053444173155386,
    0.002919762407318816,-0.004080089692405436,0.05350525490731719,-0.009916114576373838,0.01312884119736687,
    -0.03908321362767758,0.01516799203321115,-0.03483480721332517,0.05727598790346513,-0.0173423551061838,
    0.00361427733211345,-0.005045409994086753,-0.02995318051821947,-0.01242454409945843,-0.02949717212164049,
    0.01822644606078158,0.02012021879566319,-0.01626017827787076,-0.02753646534819547,0.03603467551796294,
    0.004535592300877204,0.0566429466690728,-5.421037739118262E-4,-0.002435971008171166,-0.03358949358905326,
    0.02310744863519069,-0.01337234701635081,-0.03757976698665844,-0.01877888431968287,1.958605740671749E-4,
    0.05654402718536958,-0.002427297480463568,0.02721757758235272,0.02983458273437939,-0.03948430019705625,
    0.005564645061096289,-0.01306368206354139,-0.00550193452263421,-0.02971312953926116,0.02064196824134861,
    -0.04029835660910551,-0.0118472786248906,-0.02237201569033452,0.01322260709917482,0.06198754021682162,
    0.03756365836833375,0.06031825197546948,-0.01636140235001344,0.01219108747322397,0.008339305887979234,
    -0.04036998778002789,-0.001695032515800949,0.004510185808705464,-0.04484013612113253,-0.004049914399315875,
    -0.005320267355404098,-0.04094394284357395,-0.006093448841751915,0.01208950460012208,0.01664679672170493,
    -0.01517662713895477,0.03547501342749065,-0.0278347681379248,0.03414494386544811,-0.03921697581663722,
    -0.004968772943612613,-0.02978808063505408,-0.01301827435445839,-0.003963096227555665,0.009950081865880065,
    -0.01125649740473438,-0.01181217357931198,-0.01351961435371753,-0.0801611459570406,-0.01501837638732032,
    0.01355167199567493,-0.04532957363908036,-0.02034423471665061,-0.03342325166813846,0.002102854305838838,
    -0.01225556849128399,0.009570875680082301,-0.06411684018928904,-0.05048272290781528,-0.02514283796376403,
    0.08133658427592924,-0.004173946703992577,-2.933272909252956E-4,-0.009012886456463422,0.0352335956386603,
    -0.01328112968557949,0.009843854820277756,-0.0217771564377292,0.03668153245361484,-0.04670852053050743,
    0.001423141103100033,0.04618975826833407,-0.007544419409078643,0.02156290737393875,-7.274377527143351E-4,
    -0.01545358392246465,0.0125964633369934,0.01382414777192093,0.04438503855411118,0.02408805626584756,
    0.01011051906241513,-0.001423392788659381,-0.0150243926439855,0.04568082062778543,0.02606144383687569,
    -0.04551908616782889,0.009897651877931889,0.0288973923755409,-0.02438631998530913,-0.04015029999163705,
    0.005611112523915093,-0.03220373116728923,-0.006602495111550521,-0.03351710302050102,-0.02068253422767919,
    0.00686146082715495,-0.05903659308248502,-0.02551071841224017,-0.009098761840692551,-0.04672268942304177,
    -0.00462802170627524,0.004810905196938452,-0.0537080435322717,0.01441314313041294,-0.007485730342661337,
    0.03742348643051098,-7.779708112660069E-4,0.001059017253156972,-0.03043208639556442,0.01573405782504208,
    -0.02835208168529077,-0.01415381396563251,-0.00307325045099272,-0.01313785982112555,-0.007779759605648379,
    -0.02126468834305235,-0.001672181269667238,0.02279542142324146,-0.03152539129670753,0.006569873023139425,
    -0.03723850408134562,0.02724917069209246,-0.006717302256557044,-3.065586506199754E-4,-0.04577161097135251,
    -0.05820554050265299,0.01768686724104155,-0.01647438279087286,0.03357467019206047,-0.02701097681379853,
    -0.01226338361606443,0.001957279341641967,0.01714597902879693,-0.01347154136452118,-0.003704038675478799,
    0.03388277871919861,-0.03330809398967573,-0.0361771257444093,0.01485609810663629,0.04028044448080809,
    0.02952328897316355,0.02212213163585724,-0.001321746948009177,-0.02155882951030165,-0.006364694599113506,
    0.01384500142302206,-0.008687389042539044,0.01983804698425969,-0.02750897735978443,0.03584871505875534,
    -0.01176211144233639]
    g0 = -0.07655495948325224
    g1 = -0.07290936326411175
    g2 = 1.979021728681643
    g3 = -0.1502100841737549
    g4 = 0.01629872929822685
    g5 = -0.002588396973299451
    g6 = 0.3443353572327954
    k0 = -0.2925070263392839
    k1 = -0.3148456320096934
    k2 = -0.2887346752993253
    k3 = -0.3366277921672911
    k4 = -0.3210350746574924
    k5 = 0.1504433104792134
    k6 = -0.1771984773388161
    tau = 193.8705208978095
    tau_d = 1236.052295210006
    
    '''
    # exp
    

    '''
    a0 = -0.7935692927931853
    delta = [
    -0.09126068531720762,0.3497141401810159,-0.2442744424037277,0.1740688549719809,-0.1616614001902242,
    -0.2569368870258088,-0.1722409371288114,0.08732304056611354,0.007579979100819162,-0.01565058684924775,
    -0.3060062988899542,-0.02117306157787276,0.00500457566954918,-0.2010008521136375,-0.1088075586494718,
    -0.0439200307896335,0.1416281062706454,0.09353585184214673,-0.07290803247802091,0.03134432603154616,
    0.1984460276789954,0.01051706925143121,-0.03596866243219961,0.07064952869745775,-0.03444371077460365,
    -0.02984634344872482,-0.0173657687598897,0.1924453328195301,0.07716121656777437,-0.2649066127526743,
    0.02659062361563293,-0.1793399594848475,0.02209551293538401,-0.276233484861939,-0.1511715449545762,
    0.1530254546762449,0.259253098025947,0.2346612523805217,0.04170671610508885,0.1262724363769377,
    0.07748842294361551,-0.2701716932464596,0.04889120712926796,0.08550283995735154,-0.0177664330805386,
    0.03381489805131502,-0.01433443302811427,0.005534086985660673,0.3426720147463118,0.07966708384152808,
    0.1459268925278251,-0.06894498855536083,0.01215010765444239,-0.03743652637591048,-0.06479707221636227,
    -0.1647360626970716,0.1444446599109731,0.04479224418931128,-0.1764240900819464,-0.08109435297942318,
    -0.01774744263949276,0.03870827968228845,0.03357367575089125,0.2216249288866717,0.08754850070036845,
    0.1014969297912662,-0.1246839161618553,-0.2216268494545336,-0.2034230855239076,0.006620649681138396,
    -0.1352235384950297,0.04843934263909275,-0.0296142966594957,0.04499863880084547,0.03391633224703787,
    -0.2301852024472052,0.1607626755735485,-0.0183816244653336,-0.1658963323345758,0.0497299686342309,
    0.009132182965140919,0.279287105689377,-0.2499706083692713,-0.03237861670926018,-0.1779035553185763,
    0.06329043567141941,0.1811079041091335,0.07166739063791021,0.1024658589043407,0.3079853704513007,
    -0.05720285293961155,0.0527006667492569,-0.1513244849158118,8.231226450973938E-4,-0.1292996835040609,
    -0.0457958716476368,-0.09655231435038926,0.2494764776109743,-0.1920386283013171,-0.1134761011563155,
    0.01992398909276902,0.04189611159738695,-0.02046380902911443,-0.01031200495632988,0.2988412315883269,
    -0.2532740272229027,-0.3708415713256751,-0.1325251730223005,-0.1237949818128628,0.2266274871806496,
    -0.2449030822463324,-0.02785173255715333,-0.1999106316862377,-0.05819975635193748,0.008872238623629387,
    -0.13811898732759,-0.08432315401149322,-0.2810407004363466,0.08353982683019105,-0.03025788127895551,
    -0.05688223729912589,0.07182665115931011,-0.178449275193655,0.1466937062165545,-0.1265956781068929,
    0.04664824392741164,0.02806626281025261,-0.1500947798798245,0.1385959943710686,-0.06181956008265604,
    -0.08464915289400915,-0.2995830114334138,0.00666905049045129,-0.06943962378654613,-0.09334556684771694,
    -0.1788123324839385,0.3133135554941344,0.1620490101151028,-0.2024715831090606,-0.09370961238975604,
    -0.3789067602629835,-0.002774610181657388,-0.04006351478752292,-0.03505290375348857,0.2599856572716182,
    0.003182274799019522,0.08913177765045953,-0.0431618222371188,-0.269854084376199,0.06751745079925842,
    -0.2214475132441621,-0.004668119348288522,0.2500005940252881,0.1631840462071223,0.08937213813459158,
    0.1542830902450879,0.2226010382909663,0.1398925125984214,0.2519015897283993,0.1251092213365551,
    0.07547239608840209,0.1549491769941499,0.1955676780367087,-0.1223478562320389,0.1636289247654447,
    -0.2685856964356262,-0.199039522554697,0.1618952817660454,0.1289431917155899,0.2225657036118261,
    0.144992218070155,0.07735592546439531,-0.0443328976354118,0.4084664820308471,-0.09218819377867986,
    -0.246711097042561,0.1040213601481617,-0.1117286829061738,-0.06003918977391487,0.2162722050268727,
    0.2022069518061652,0.02136050614409658,-0.1929149001684831,-0.007814040141341969,-0.1711114524776153,
    0.007359903281811402,-0.2670175280714708,-0.1227860229574066,0.3101551410238161,-0.1599680931283837,
    0.1532743047748322,-0.04691489651735361,0.05963840306071271,0.1770211518043206,0.06582817430273848,
    -0.07164017468725106,0.2414129818836657,0.08009552434003642,-0.001788326137002347,0.06089052420956225,
    0.2058163908151794,0.02909018965191511,-0.08128485701989735,-0.3201082884270527,-0.03389876074206516,
    -0.1504877432024849,0.03843030999609561,0.4221479101299878,0.02725492849500439,-0.2660441378461356,
    -0.02811743704013199,0.018005317674296,0.2134633924048027,-0.1885742864116143,-1.095419980266483E-4,
    -0.2575220270488868,-0.02302535144994836,0.1562522354173013,0.2929260851954136,-0.06632610463907244,
    -0.06543822722512034,-0.04680525428683577,0.1200998871702855,-0.01289280859991743,-0.3648016661366494,
    0.03546051699819736,-0.03823334311267919,-0.2211017963136861,-0.07479207312545209,0.009753125193236232,
    0.1367457984733927,0.3927316693612133,-0.2860851418931973,-0.2408226231373446,-0.09684822132932028,
    0.08144492457331098,-0.2151381290686588,-0.2043873117397273,-0.2084702121153649,-0.1596160960953405,
    0.2566383883862453,0.0649456905065887,0.2745969879832593,0.02177431065128676,0.0252779921444841,
    -0.001545233967589938,0.08541417294220729,0.01412540572034845,-0.03644579410001715,-0.1595111542849481,
    0.1262975574180936,-0.169793099133329,-0.1909680166552868,0.002710373582009025,0.06981252677081175,
    -0.1949160861209301,-0.009347659109385882,0.08838228466320559,0.1824150448804983,-0.2956499143434421,
    0.1136356071688852,-0.2516709937994435,0.06326915629986325,-0.255844914648724,-0.0760265724819891,
    -0.2497263922580183,0.02485432565123141,0.1913304110305928,-0.06550949419480068,0.1202896669824193,
    -0.1449525383205622,0.1806726910144297,-0.08044306105482497,0.1147051873545206,0.01530414516958286,
    0.06840856270813553,0.09427409664816991,-0.1423153894437732,0.1907897050265903,-0.2836246352142622,
    -0.108215420953192,0.02539668249622131,-0.3430982932523516,0.01508167934001183,0.05397243028181234,
    -0.2667225320663438,-0.1162925844262451,-0.2677636624603509,0.1387620655903944,-0.1499671609803017,
    -0.1100937976039559,0.06859186270360387,-0.05696912537006433,0.1420833484841354,0.1976911273772314,
    0.2243341013795136,0.08207021000302715,-0.1099323690141504,0.05493344519571897,0.2508725943006603,
    -0.1755806811013328,0.3374923934679425,0.01890183151382643,-0.2073701828832489,0.03391163236916706,
    0.1206052318918301,0.2405991882030403,-0.07994043728420203,0.08070260913870844]
    g0 = 0.3143480560128074
    g1 = 0.1448834874077853
    g2 = 0.4574870155454441
    g3 = -0.09441933039873253
    g4 = 0.0459303744535855
    g5 = -0.2906265892451004
    g6 = -1.375841659245782
    g7 = -0.07325280298864306
    g8 = -0.7450787151014608
    k0 = 1.501776765911339
    k1 = 1.499739417099974
    k2 = 1.669311051417013
    k3 = 1.732975647425862
    k4 = 1.88834715390721
    k5 = -2.780700880394835
    k6 = 2.765145773383769
    tau = 23.7124227685855
    tau_d = 40.54948009511896
    '''



    '''
    a0 = -0.8123608294054911
    delta = [
    -0.02126019403318461,0.01166966290363169,0.03490774750298662,0.104984969689401,0.1024938071976637,
    0.09721827515776904,-0.0299963344518368,0.03357055645597543,-0.09974466975443859,0.0609968423664128,
    -0.04035639343242799,-0.02211603440345729,-0.01907200505801182,0.01865169022111092,-0.01189545054744876,
    -0.08416551800614998,0.02370580209800394,0.0193140164854002,-0.09044368309211404,0.05620532806293998,
    0.03440364311387589,0.01021415565123355,-0.02273655170014729,-0.006697723673663618,-0.1095592205571495,
    0.01950346680203698,-0.01260857924596135,0.03559853890407436,-0.05294487246619087,0.004047837191504072,
    -0.02934775606605416,0.05425605921256528,-0.06383568895709464,-0.003710594199582455,-0.1034930724594907,
    -0.08536771756241213,-0.114392580996471,-0.03102822676657601,0.02074644301842354,-0.0558640523530594,
    0.07011867052485514,-0.01465655995994965,0.07194606774846263,-0.01710435071765181,-0.01149104889311545,
    -0.02464650544450033,-0.0292959206131969,0.09939459437775693,0.04909571859514206,-0.04711984157826837,
    -0.01361799479701015,-0.08808306276506732,-0.02496805700176736,-0.006918397031873372,0.003894586793619783,
    -0.01255451997606826,0.03454998491583082,-0.03801112896670831,0.007439732839947341,0.05777092508867582,
    -0.1252073264063187,-0.0271776522109817,-0.02103345571544374,-0.01176134460534866,-0.01202136488421181,
    -0.0322641833647049,0.02762454238973969,0.06293081431677103,-0.04563954118298815,-0.06819638580857162,
    0.1194802987819479,0.06669439078926771,-0.001217714180756723,-0.01151686970212553,0.02499070565214792,
    0.05204348979088821,0.1061607416777116,0.1751199702134328,-0.07124038418940409,0.002660599388981752,
    -0.07448335719043588,-0.00102177362747347,-0.04561659355951056,0.02871306586943437,-0.0378496959088517,
    -0.1269122547420088,0.07437824868914129,0.078900338791924,0.03642862078714574,0.09577157458731508,
    -0.03741968016714867,0.05166863128786073,-0.02741764571292595,-0.01633712701309788,-0.03110103174937471,
    0.04286675021682592,0.006403370541204778,0.0569898003716201,-0.0657389278372839,0.02864824564200064,
    -0.06749621736513595,-0.04049073245482252,0.01793511457256312,0.02994156158072777,0.07013969656343019,
    -0.08466238892172227,-0.01378565305486029,0.01772571582127279,0.005571334739283035,0.01938767283966511,
    0.05704597924191284,0.0164836089660854,-0.03070402248840079,-0.03437758868723517,-0.03112454387645607,
    0.04106192768159998,0.04901563115270611,-0.002744812645307491,-0.01054261397145699,-0.04388227508999596,
    -0.02616957259786016,-0.02047085411747038,0.09577267351486568,0.01755391985642258,-0.02909178504078958,
    -0.0380710166780658,0.06938603189879321,-0.01839238760306802,-0.01721187837831024,-0.07688068533389222,
    0.01919908475999821,-0.02301189386401702,-0.0368480311854153,0.05810963511748943,-0.05137550432376257,
    0.01250879121883134,-4.250998390748425E-4,0.1002715953813501,-0.03268720695099615,-0.04435471752800294,
    -0.1025257375798014,-0.03516725051209195,-0.01324075390434035,0.1689399173081448,-0.02545852484675643,
    0.01592167376724294,0.03127571967794879,-0.01914751694555145,0.007360174160664723,-0.02507790475648703,
    0.01865352446950382,-0.02321159776058297,0.03075236567785414,-0.008864419143796584,-0.02371439860481551,
    -0.1334499468846506,0.0472599925726082,0.1079556806662438,-0.01716383600738662,0.04097886357050683,
    0.1326731320121651,-0.09293251627125301,-0.1263741384428405,-0.1394140078781918,-0.06311660731270012,
    0.05393243718723324,-0.05267999547900185,0.01239932215950613,0.02436499721546657,-0.04662285700067796,
    -0.04189580931332222,-0.08173576859327927,0.07385034625140138,-0.004324684148694977,0.0225047469161612,
    -0.08796502397286539,-0.004642492987569225,-0.08239463366403825,0.1288404287328203,-0.02961391978230954,
    0.05437437416937105,-0.01937178519823506,0.1020323830856042,-0.04476529086652836,0.04813140034956552,
    0.00625459846838909,0.06513235037561869,0.009892307106208139,-0.02835673825167095,0.0289858444980575,
    0.05318531291886503,-0.04259126250021377,0.04578907802979518,0.1503163318351902,-0.005847612829814711,
    -0.02443468744328756,-0.06346442986093594,0.01066678719501392,0.06361946534372503,0.002106424601367265,
    0.04975788399584158,0.06312494425648141,0.02718465399348287,-0.03334692066993948,0.06658472431014067,
    0.06046219043561775,-0.007466989656211093,0.04041967405426789,-0.04104751138549721,-0.04071767457867994,
    -0.0536154597161347,-0.004381422830594501,-0.03264866892951684,0.08080643887997285,-0.1363984793512388,
    0.05397593571705325,0.004523219844574381,-0.0123898645162266,-0.03368679494052716,0.0416090058253499,
    -0.0381821616961824,-0.0116686860793781,0.01951730524731364,-0.03532186698697603,-0.04886278435268009,
    -0.0153460218509253,-0.003128507730905234,-0.07116274042773599,-0.01319523642719519,1.599454720201701E-4,
    0.007753515453540066,0.02764962022003389,-5.947065747110944E-4,0.001207414540750921,-0.0501667317477091,
    0.009063677900099957,-0.03124418757795079,-0.03526116976111697,0.04877851021253504,-0.01734924678378521,
    -0.02061309797422747,0.02554515683626569,0.05042594882242527,0.0320282977919517,-0.01591365587306881,
    -0.04997160739924717,-0.003470770031236049,-0.01870014664348389,0.03246848512171212,-0.02817365344636307,
    0.03766923314582069,-0.09369893819172154,0.0366061517814518,-0.01888951548204952,-0.0647160443482047,
    -0.04514913087952177,0.06989755867623769,-0.05750440482697335,0.05004099140791891,-0.04964468762935031,
    -0.01143871355053993,-0.1163808338661814,0.02083887522165035,-0.02450755877304947,0.01372230349990267,
    -0.02052185785758871,0.06773902883461339,0.02987436211770119,0.04136734575940578,-0.03760933510395355,
    -0.004906973715172344,-0.01498249656036615,0.04811653433956367,0.01891719310572998,0.02404711123223681,
    -0.01199536402093405,0.06215613856603489,0.03497436395363654,0.03497851683367248,-0.01261959563669182,
    0.02038169710744206,0.09923447610560369,-0.009930006026076214,0.01497843568047624,0.002825205694923906,
    -0.06372063270901357,0.001212567559603713,0.02590360025310305,-0.006101195646415039,-0.07113605371272907,
    0.06737732782768534,-0.07510327666537013,0.029976921661258,0.03959325843022726,-0.01913358329132892,
    -0.02418452658528618,-0.02538286785069575,-0.05663433464030612,-0.007954109571573251,-0.04672481703598017,
    -0.04654767362908482,0.009674054354611864,-0.03077422932670961,-0.01459714437282526,0.03208627213829412,
    0.02775966804092166,-0.07034053631056041,0.06034787661886889,-0.02166821915684548]
    g0 = 0.2386499505865169
    g1 = -0.1472065372182086
    g2 = 0.002285656565335468
    g3 = -0.2496027669543877
    g4 = 0.01985987376905292
    g5 = 0.1587040746832074
    g6 = 1.472100561470314
    k0 = -1.468538474950963
    k1 = -1.443028419442953
    k2 = -1.091544527799617
    k3 = -0.9989557522309918
    k4 = -0.8906048614146369
    k5 = -0.3560868055051729
    k6 = 0.3549357868693386
    tau = 21.69584441326981
    tau_d = 351.8526605627713
    '''
    

    def hahaha(i,r=[s0[i],s1[i],s2[i],s3[i],s4[i],S_dph[i],R_dph[i]]):
        Ss = r[0]*k0 + r[1]*k1 + r[2]*k2 + r[3]*k3 + r[4]*k4 + r[5]*k5 + r[6]*k6
        Gs = g0*G[i]  + g1*Score[i] + g2*R[i] +g3*V[i] + g4*Net[i]+ g5*Bp[i] + g6*Server[i] + g7*Server[i]*G[i]
        t = a0 + Ss*Server[i] + Gs + delta[int(i/df.shape[0]*321)]
        return 1/(1+np.exp(-t))
    #delta[int(i/df.shape[0]*320)]


    pre = np.zeros(df.shape[0])
    '''for i in range(2,df.shape[0]-1):
        pre[i+1] = hahaha(i)
    pre[df.shape[0]-1] = pre[df.shape[0]-2]'''
    for i in range(1,df.shape[0]):
        pre[i] = hahaha(i)
    
    
    
    
    
    
    k = 0
    for i in range(df.shape[0]):
        if (pre[i]>0.5 and P[i] >=0.5) or (pre[i]<0.5 and P[i] <=0.5):
            k += 1
        else:
            pass
    print('Acc:',k/df.shape[0])
    # print(pre)
    custom_palette = sns.color_palette("RdBu", n_colors=10)
    ####作图区域：pre: np.array,  P: np.array   概率值拟合程度
    newP = np.roll(P, 1)
    
    # 计算需要保留的元素数量（后20%）
    to_keep = int(len(pre) * 0.2)

    # 获取后20%的部分
    pre_n2p = pre[-to_keep:]
    P_n2p = newP[-to_keep:]
    plt.figure(figsize=(16, 6))
    sns.set(style="whitegrid", palette=custom_palette)
    plt.plot(range(to_keep),pre_n2p ,label='pre', color=custom_palette[0])
    plt.plot(range(to_keep),P_n2p,label='P', color=custom_palette[9])

    # 添加标题和标签
    plt.title('Comparison of Pre and P')
    plt.xlabel('Index')
    plt.ylabel('Value')

    # 显示图例
    plt.legend()
    plt.gca().set_facecolor('#f5f5f5')
    # 显示图形
    plt.show()



    m1 = np.array([hahaha(i,r=[1,0,0,0,0,S_dph[i],R_dph[i]]) for i in range(df.shape[0])])
    m2 = np.array([hahaha(i,r=[0,1,0,0,0,S_dph[i],R_dph[i]]) for i in range(df.shape[0])])
    m3 = np.array([hahaha(i,r=[0,0,1,0,0,S_dph[i],R_dph[i]]) for i in range(df.shape[0])])
    m4 = np.array([hahaha(i,r=[0,0,0,1,0,S_dph[i],R_dph[i]]) for i in range(df.shape[0])])
    m5 = np.array([hahaha(i,r=[0,0,0,0,1,S_dph[i],R_dph[i]]) for i in range(df.shape[0])])
    m6 = np.array([hahaha(i,r=[s0[i],s1[i],s2[i],s3[i],s4[i],0,R_dph[i]]) for i in range(df.shape[0])])
    m7 = np.array([hahaha(i,r=[s0[i],s1[i],s2[i],s3[i],s4[i],1,R_dph[i]]) for i in range(df.shape[0])])
    m8 = np.array([hahaha(i,r=[s0[i],s1[i],s2[i],s3[i],s4[i],S_dph[i],0]) for i in range(df.shape[0])])
    m9 = np.array([hahaha(i,r=[s0[i],s1[i],s2[i],s3[i],s4[i],S_dph[i],1]) for i in range(df.shape[0])])


    #sns.scatterplot(m1)
    #sns.lineplot(m2)
    #sns.lineplot(m3)
    #sns.lineplot(m4)
    #sns.lineplot(m5)
    #sns.lineplot(m2-P)
    #sns.scatterplot(G)
    def tru(i,arr,k=1):
        if (arr[i]-P[i])>=0 and Server[i] == k and G[i]<=0:
            return 1
        elif Server[i] == -1 or G[i]>0:
            return 0
        else:
            return -1


    mm1 = np.array([tru(i,m1) for i in range(df.shape[0])])
    mm2 = np.array([tru(i,m2) for i in range(df.shape[0])])
    mm3 = np.array([tru(i,m3) for i in range(df.shape[0])])
    mm4 = np.array([tru(i,m4) for i in range(df.shape[0])])
    mm5 = np.array([tru(i,m5) for i in range(df.shape[0])])
    mm6 = np.array([tru(i,m6) for i in range(df.shape[0])])
    mm7 = np.array([tru(i,m7) for i in range(df.shape[0])])
    mm8 = np.array([tru(i,m8) for i in range(df.shape[0])])
    mm9 = np.array([tru(i,m9,k=-1) for i in range(df.shape[0])])

    a=np.sum(mm1 == 1)/(np.sum(mm1 == 1)+np.sum(mm1 == -1))
    b=np.sum(mm2 == 1)/(np.sum(mm2 == 1)+np.sum(mm2 == -1))
    c=np.sum(mm3 == 1)/(np.sum(mm3 == 1)+np.sum(mm3 == -1))
    d=np.sum(mm4 == 1)/(np.sum(mm4 == 1)+np.sum(mm4 == -1))
    e=np.sum(mm5 == 1)/(np.sum(mm5 == 1)+np.sum(mm5 == -1))
    f=np.sum(mm6 == 1)/(np.sum(mm6 == 1)+np.sum(mm6 == -1))
    g=np.sum(mm7 == 1)/(np.sum(mm7 == 1)+np.sum(mm7 == -1))
    h=np.sum(mm8 == 1)/(np.sum(mm8 == 1)+np.sum(mm8 == -1))
    i=np.sum(mm9 == 1)/(np.sum(mm9 == 1)+np.sum(mm9 == -1))
    
    return np.array([a,b,c,d,e,f,g,h,i])

    '''sns.histplot(mm1)
    sns.histplot(mm2)
    sns.histplot(mm3)
    sns.histplot(mm4)
    sns.histplot(mm5)'''
    #plt.show()






a0 = 0.02487295261707338
delta = [
-1.341425334629614,1.34913551024473,1.410475256696752,0.2660694571982221,0.7696471774539705,
-0.5336554865137383,-0.03104444895136851,1.696191360533341,-0.05078481909718342,1.26868652422087,
0.5410885280489712,0.1318157526841554,1.188702103343439,0.7960218101097388,-0.5781844508181735,
-1.629594885533915,0.9148007648294862,-1.006579719310543,-1.020210870165751,1.337903835083826,
0.005068855399505733,-0.3590675655980871,0.1239662773447658,-0.8049525061483414,-0.2134830337333848,
-0.4067358805514706,-0.1480810617685772,-0.7367692569014747,1.099818456014218,1.051657365865893,
0.1241428900807405,0.009996808596981002,-1.157189447373317,0.8807817808092941,0.6103753580758797,
-1.075657673449573,0.646871481439016,-1.121134097680253,0.5883753150915084,-0.2035703138851746,
-0.6181034919417384,-1.355014758373551,-1.372644593082003,-0.9685846181223593,1.544454564727532,
0.4936985100238371,-0.6613825308806169,-0.2280530458070724,-0.9616992625213715,0.8986081415867732,
0.03646996278560445,-0.872539175629209,-1.927979372230165,0.2567662419226468,-1.244342722713624,
-0.8287440452767248,-1.498580854853458,-0.2957073435184345,0.6399737673372244,-0.1097561854774844,
0.7363535981954041,0.6636352942553582,0.3461465790462088,0.2966587593221779,0.7305223347818157,
1.115084583130431,0.2083792535863238,0.2561938060221612,-0.3413975984400995,-1.167054413989218,
0.677585060237497,1.16832630735838,-0.8844676584574158,1.851259730456774,-1.440544919057451,
-0.4109632705977151,-0.2917466497532389,0.5267122766981683,-1.146005905402342,0.8398562947467355,
-0.1840350658946011,-0.4946982112188669,-0.9439828952864471,-0.8385686129022996,0.9312059198247541,
-0.1605048456358695,0.1326745125454637,-0.5180611269154064,-0.1379178165112087,-1.211719377967254,
-0.1574746689716172,0.3219564405113884,-0.6206504461476184,0.07066595176065674,0.9109095670025861,
-0.4329864238404617,-0.1322087661711904,-1.019223277527797,-1.114239650844904,0.4445851524553797,
1.727964590844978,0.203170800088207,0.9914648853345724,0.4723447447452221,-0.05111549851636921,
1.336172015940112,0.289231396802928,-0.7383900857704279,-1.109281396135097,0.2676227540818958,
-0.8961109720240956,0.3650254775140141,-0.09554036988097349,0.4054083441183322,0.667449159322264,
0.04174175726872754,-0.1288052848737789,-0.8892960993937143,1.453712861349158,0.5218846134633258,
-0.07528438058052407,0.4126794145113568,-0.8119577253672867,1.645801412982166,-0.848200025773904,
0.2649724666007843,0.3842285029535302,0.9207542021885138,0.4141743260681218,0.6269662974595818,
-0.272188829757159,1.165064913152947,-0.06884710749867355,0.3307114156370787,-0.7738441500556424,
-1.390038464745269,0.4170196366530545,0.196789048037965,-0.3404397947557473,0.05924604609969856,
-1.393459508009377,0.2426533790306466,0.1781662832133004,0.3652803517358723,0.2935151204879256,
-0.3235432345708728,0.3194782768659561,1.937313095628131,-1.316844343350629,-0.5184790113341706,
0.5840495184587665,0.220653938674205,-1.40790328816027,0.4611159703173074,0.2759973975005408,
-0.4866727052324309,0.1918039237306148,-1.076264019474968,-0.1993337060716026,-0.3282209128207569,
-0.9519584050891736,0.6239116374502084,-1.16250253790128,-0.37104013492626,-0.4806715282676537,
0.4740775006144453,-0.5938453336416682,-0.7468139885979801,0.5663314832611104,0.9838902030213345,
0.5841716452432447,1.22517099076391,-0.1177567347872526,0.2926596560745395,0.8629291830745415,
-0.7913017573358517,-1.120241781608923,-0.5315064098698933,-0.4575974619040541,0.7105287770278451,
0.2849391899700957,-1.232548096543846,0.3453566089519109,0.04103646032144225,0.6948153083576212,
-1.135463426942081,-0.6995732778725839,-1.130126019215473,1.933987324005378,0.2739191431300951,
-0.5106441772472635,0.07566987441886878,-1.29063185942554,0.8023281016132379,0.04536261288479916,
-0.1598577412199755,-0.9677862584185981,-0.1779486806420843,-0.5936079079321777,-0.5974385148750483,
-0.1172866115862289,-0.142836329316874,0.1894572532352537,-1.174054738812358,-0.3308959795715805,
1.242286860144871,0.7783754012396608,0.656867516600775,-0.7852169182981501,-0.2999222517952232,
-0.7187971915153327,0.1746067875765087,-0.2572610183725591,-0.541331929453577,0.2531643791403048,
0.2385905930400905,1.794321548793688,-0.8118420738624578,0.5667613722040633,0.9305309862773277,
0.002351291121398426,0.2776028887251388,0.07429200840024784,0.3616449117366186,-0.328879736989996,
0.2157963741330371,0.7523942431148839,-1.193922115740677,-0.6468902922495623,1.121365468141285,
-1.825476452972109,0.5699555352460055,1.534031604613995,-0.3290898122821162,1.302824602763335,
-0.04252028413765939,-1.046724229758581,0.3521999770262241,0.14807991984751,-0.2677604781705834,
1.079532483573168,-2.586088498786364,0.7278837035308924,-0.1144770873941012,-0.2391892668490483,
-0.3453539911550905,-1.922187951238914,0.5518155026455226,0.2931890656833076,0.462754876789401,
0.09206472200931388,1.103584463584262,0.3170539435831788,0.6937816035120672,1.257734949286189,
-1.372679799733942,0.2737959578792291,0.7914619325735722,-0.06996021763210532,0.4488393461816889,
-0.3592520176093297,-0.06026829625394599,0.9161093146780795,0.2831484496199532,0.649440430979908,
0.827241952751814,0.6427787003925345,0.03402236941770685,-0.688355483537427,0.2511017086794497,
-0.8900130392719655,0.1624228647055677,1.11861027680412,0.9279816595211989,-0.3436642945995125,
1.12252783806121,0.7695943104786674,-0.7565542696032634,0.8930842102372417,0.1797916177019109,
-0.571382313669341,-0.9726933610250112,1.27802567055137,1.135648945710877,-0.184432073923341,
-0.4747293995519874,-0.5218228227081401,-0.1373409202478675,1.114548658803711,-0.2571427774306474,
0.4296031089356509,-0.9694685159730474,-0.4090780262757009,0.3478860628824599,-0.1594032824136621,
0.9006967045333165,0.1588641446169639,-0.1292153974975588,-0.8455984192625722,0.9710529759819022,
-0.8758933581458561,-0.220618308774058,-0.4330075746901217,0.7553869960577552,-0.1732940186306136,
-0.680017203753797,-0.395039846611507,-0.5799345472837445,-0.666795371038419,0.2652084639925431,
-0.3111832972406878,-0.03601670626406841,0.8230948982736599,1.141711931986372,-0.5036549633131538,
0.1814329604141066,0.02039840444568691,1.110823104492927,0.7096324734175932,-0.3300355791735359,
-0.3603415917339533]
g0 = 0.1989525110900083
g1 = 0.01217439055417175
g2 = -0.001054595497499601
g3 = -2.210053123817004
g4 = -0.07406493436431361
g5 = -0.7027931268581541
g6 = -7.449886088627544
g7 = 0.03303518626734488
k0 = 7.268723615007642
k1 = 7.877432318024248
k2 = 7.982807803513984
k3 = 8.640302697956583
k4 = 8.683567710079924
k5 = -6.715647459639007
k6 = 6.16637593236711
tau = 35.97649715984348
tau_d = 1.562316130156271








my('processed1312')
'''
list=['processed1301','processed1302','processed1303','processed1304','processed1305','processed1306','processed1307',
      'processed1308','processed1309','processed1312','processed1313','processed1314',
      'processed1315','processed1316','processed1401','processed1402','processed1403','processed1404','processed1405',
      'processed1406','processed1407','processed1408','processed1501','processed1502','processed1503','processed1504',
      'processed1601','processed1602','processed1701']
print(len(list))
tt = np.zeros((29,9))
for i in range(len(list)):
    print(i)
    tt[i] = my(list[i])
print(tt)
np.savetxt('tt.txt',X=tt)
dff = pd.DataFrame(tt,columns=['Serve_Wdh_0','Serve_Wdh_1','Serve_Wdh_2','Serve_Wdh_3','Serve_Wdh_4','Serve_Dph_0','Serve_Dph_1','Serve_Dph_0','Rcv_Dph_1'])
dff.to_csv('dff.csv')
'''